# Exploiting_AD

1. Enumerate AD
2. Once we have a foothold of an AD, the gola is to escalate privilege level
3. Within AD environment there can be different groups ahving different permissions to access objects. So we are going to target high value group.
4. If get admin group, then we will have control of every signle computer in AD.
5. we can also target Domain controller directly. Domain controller have hases of passwords of each and every machine in domain controller
6. 

7. Consider that we  have successfully exploited a machine in donmain. the machine was of group Offsec@corp. this machine is also a member of local administrator group.
8. enumerate the machine and group to avaluate high level targets.
9. tools and techniques used to enumerate machine without admin permissions

  
-- This command enumerate all local users in a windows machine
```net user```

-- This command will enumerate all user in entier domain
```net user /domain```
once we have name of users, we can query information about each user
```net user <name of user> /domain```
In this command look for global group membership --> this can let you know if  the user is in local admin group or not

```net group /domain```
This command is going to let you know all the custom groups in domain


10. In AD there can be nested group. one group and its members can be added as a member of another group.


-- we can use powershell to enumerate AD 
--ldap is a network protocol understood by DC.
ldap is an API. performs search function against Active Directories. this will allow us to interface with DC using powershell and obtain unpriviledged information  in the domain 

``` [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()```
where ```System.DirectoryServices.ActiveDirectory``` is namespace and ```domain``` is class. domain class contains a method ```GetCurrentDomain()```. This is going to retrieve the domain for currently logged in user. ```Here look for the name property, it will tell about the domain name and then look for primary domain controller in PdcRoleOwner```



```Powershell
$doaminObj = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()
$PDC = ($domainObj.PdcRoleOwner).Name
$SearchString = "LDAP://"
$SearchString  += $PDC + "/"
$DistinguishedName = "DC=$($domainObj.Name.Replace('.', ',DC='))"
$SearchString += $DistinguisheName
$SearchString
#This script is going to print full ldap provider path needed to perform ldap queries against domain controller

$Searcher = New-Object System.DirectoryService.DicrectorySearcher([ADSI]$SearchString)
# DirectorySearcher is a class and System.DirectoryService is a namespace
$objDomain =  New-Object System.DirectoryServices.DirectoryEntry
$Searcher.SearchRoot = $objDomain
$Result =  $Search.FindAll()
Foreach($obj in $Result)
{ 
    Foreach($prop in $obj.Properties)
    {
        $prop
    }
    Write-hosts "-----------------------------"
}
```


